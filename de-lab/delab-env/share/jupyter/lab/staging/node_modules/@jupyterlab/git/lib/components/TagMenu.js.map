{"version":3,"file":"TagMenu.js","sourceRoot":"./@jupyterlab/git/src/","sources":["components/TagMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Dialog, showDialog, showErrorMessage } from '@jupyterlab/apputils';\nimport { TranslationBundle } from '@jupyterlab/translation';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport * as React from 'react';\nimport { FixedSizeList, ListChildComponentProps } from 'react-window';\nimport { Logger } from '../logger';\nimport {\n  nameClass,\n  filterClass,\n  filterClearClass,\n  filterInputClass,\n  filterWrapperClass,\n  listItemClass,\n  listItemIconClass,\n  wrapperClass\n} from '../style/BranchMenu';\nimport { tagIcon } from '../style/icons';\nimport { IGitExtension, Level } from '../tokens';\n\nconst ITEM_HEIGHT = 24.8; // HTML element height for a single branch\nconst MIN_HEIGHT = 150; // Minimal HTML element height for the tags list\nconst MAX_HEIGHT = 400; // Maximal HTML element height for the tags list\n\n/**\n * Callback invoked upon encountering an error when switching tags.\n *\n * @private\n * @param error - error\n * @param logger - the logger\n */\nfunction onTagError(\n  error: any,\n  logger: Logger,\n  trans: TranslationBundle\n): void {\n  if (error.message.includes('following files would be overwritten')) {\n    // Empty log message to hide the executing alert\n    logger.log({\n      message: '',\n      level: Level.INFO\n    });\n    showDialog({\n      title: trans.__('Unable to checkout tag'),\n      body: (\n        <React.Fragment>\n          <p>\n            {trans.__(\n              'Your changes to the following files would be overwritten by switching:'\n            )}\n          </p>\n          <List>\n            {error.message.split('\\n').slice(1, -3).map(renderFileName)}\n          </List>\n          <span>\n            {trans.__(\n              'Please commit, stash, or discard your changes before you checkout tags.'\n            )}\n          </span>\n        </React.Fragment>\n      ),\n      buttons: [Dialog.okButton({ label: trans.__('Dismiss') })]\n    });\n  } else {\n    logger.log({\n      level: Level.ERROR,\n      message: trans.__('Failed to checkout tag.'),\n      error\n    });\n  }\n}\n\n/**\n * Renders a file name.\n *\n * @private\n * @param filename - file name\n * @returns React element\n */\nfunction renderFileName(filename: string): React.ReactElement {\n  return <ListItem key={filename}>{filename}</ListItem>;\n}\n\n/**\n * Interface describing component properties.\n */\nexport interface ITagMenuProps {\n  /**\n   * Boolean indicating whether branching is disabled.\n   */\n  branching: boolean;\n\n  /**\n   * Extension logger\n   */\n  logger: Logger;\n\n  /**\n   * Git extension data model.\n   */\n  model: IGitExtension;\n\n  /**\n   * The application language translator.\n   */\n  trans: TranslationBundle;\n}\n\n/**\n * Interface describing component state.\n */\nexport interface ITagMenuState {\n  /**\n   * Menu filter.\n   */\n  filter: string;\n\n  /**\n   * Current list of tags.\n   */\n  tags: string[];\n}\n\n/**\n * React component for rendering a branch menu.\n */\nexport class TagMenu extends React.Component<ITagMenuProps, ITagMenuState> {\n  /**\n   * Returns a React component for rendering a branch menu.\n   *\n   * @param props - component properties\n   * @returns React component\n   */\n  constructor(props: ITagMenuProps) {\n    super(props);\n\n    this.state = {\n      filter: '',\n      tags: []\n    };\n  }\n\n  componentDidMount(): void {\n    this.props.model\n      .tags()\n      .then(response => {\n        this.setState({\n          tags: response.tags\n        });\n      })\n      .catch(error => {\n        console.error(error);\n        this.setState({\n          tags: []\n        });\n        showErrorMessage(this.props.trans.__('Fail to get the tags.'), error);\n      });\n  }\n\n  /**\n   * Renders the component.\n   *\n   * @returns React element\n   */\n  render(): React.ReactElement {\n    return (\n      <div className={wrapperClass}>\n        {this._renderFilter()}\n        {this._renderTagList()}\n      </div>\n    );\n  }\n\n  /**\n   * Renders a branch input filter.\n   *\n   * @returns React element\n   */\n  private _renderFilter(): React.ReactElement {\n    return (\n      <div className={filterWrapperClass}>\n        <div className={filterClass}>\n          <input\n            className={filterInputClass}\n            type=\"text\"\n            onChange={this._onFilterChange}\n            value={this.state.filter}\n            placeholder={this.props.trans.__('Filter')}\n            title={this.props.trans.__('Filter branch menu')}\n          />\n          {this.state.filter ? (\n            <button className={filterClearClass}>\n              <ClearIcon\n                titleAccess={this.props.trans.__('Clear the current filter')}\n                fontSize=\"small\"\n                onClick={this._resetFilter}\n              />\n            </button>\n          ) : null}\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Renders a\n   *\n   * @returns React element\n   */\n  private _renderTagList(): React.ReactElement {\n    // Perform a \"simple\" filter... (TODO: consider implementing fuzzy filtering)\n    const filter = this.state.filter;\n    const tags = this.state.tags.filter(tag => !filter || tag.includes(filter));\n    return (\n      <FixedSizeList\n        height={Math.min(\n          Math.max(MIN_HEIGHT, tags.length * ITEM_HEIGHT),\n          MAX_HEIGHT\n        )}\n        itemCount={tags.length}\n        itemData={tags}\n        itemKey={(index, data) => data[index]}\n        itemSize={ITEM_HEIGHT}\n        style={{ overflowX: 'hidden', paddingTop: 0, paddingBottom: 0 }}\n        width={'auto'}\n      >\n        {this._renderItem}\n      </FixedSizeList>\n    );\n  }\n\n  /**\n   * Renders a menu item.\n   *\n   * @param props Row properties\n   * @returns React element\n   */\n  private _renderItem = (props: ListChildComponentProps): JSX.Element => {\n    const { data, index, style } = props;\n    const tag = data[index] as string;\n\n    return (\n      <ListItem\n        button\n        title={this.props.trans.__('Checkout to tag: %1', tag)}\n        className={listItemClass}\n        onClick={this._onTagClickFactory(tag)}\n        style={style}\n      >\n        <tagIcon.react className={listItemIconClass} tag=\"span\" />\n        <span className={nameClass}>{tag}</span>\n      </ListItem>\n    );\n  };\n\n  /**\n   * Callback invoked upon a change to the menu filter.\n   *\n   * @param event - event object\n   */\n  private _onFilterChange = (event: any): void => {\n    this.setState({\n      filter: event.target.value\n    });\n  };\n\n  /**\n   * Callback invoked to reset the menu filter.\n   */\n  private _resetFilter = (): void => {\n    this.setState({\n      filter: ''\n    });\n  };\n\n  /**\n   * Returns a callback which is invoked upon clicking a tag.\n   *\n   * @param branch - tag\n   * @returns callback\n   */\n  private _onTagClickFactory(tag: string) {\n    const self = this;\n    return onClick;\n\n    /**\n     * Callback invoked upon clicking a tag.\n     *\n     * @private\n     * @param event - event object\n     * @returns promise which resolves upon attempting to switch tags\n     */\n    async function onClick(): Promise<void> {\n      if (!self.props.branching) {\n        showErrorMessage(\n          self.props.trans.__('Checkout tags is disabled'),\n          self.props.trans.__(\n            'The repository contains files with uncommitted changes. Please commit or discard these changes before switching to a tag.'\n          )\n        );\n        return;\n      }\n\n      self.props.logger.log({\n        level: Level.RUNNING,\n        message: self.props.trans.__('Checking tag out…')\n      });\n\n      try {\n        await self.props.model.checkoutTag(tag);\n      } catch (err) {\n        return onTagError(err, self.props.logger, self.props.trans);\n      }\n\n      self.props.logger.log({\n        level: Level.SUCCESS,\n        message: self.props.trans.__('Tag checkout.')\n      });\n    }\n  }\n}\n"]}