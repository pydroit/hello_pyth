{"version":3,"file":"ResetRevertDialog.js","sourceRoot":"./@jupyterlab/git/src/","sources":["components/ResetRevertDialog.tsx"],"names":[],"mappings":"AACA,OAAO,MAAM,MAAM,0BAA0B,CAAC;AAC9C,OAAO,aAAa,MAAM,iCAAiC,CAAC;AAC5D,OAAO,SAAS,MAAM,0BAA0B,CAAC;AACjD,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAC/B,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AAEpC,OAAO,EACL,mBAAmB,EACnB,WAAW,EACX,iBAAiB,EACjB,gBAAgB,EAChB,eAAe,EACf,mBAAmB,EACnB,sBAAsB,EACtB,iBAAiB,EACjB,UAAU,EACV,iBAAiB,EAClB,MAAM,4BAA4B,CAAC;AACpC,OAAO,EAAsB,KAAK,EAAE,MAAM,WAAW,CAAC;AACtD,OAAO,EAAE,aAAa,EAAE,MAAM,iBAAiB,CAAC;AA8DhD;;GAEG;AACH,MAAM,OAAO,iBAAkB,SAAQ,KAAK,CAAC,SAG5C;IACC;;;;;OAKG;IACH,YAAY,KAA8B;QACxC,KAAK,CAAC,KAAK,CAAC,CAAC;QAsFf;;WAEG;QACK,qBAAgB,GAAG,CAAC,OAAe,EAAQ,EAAE;YACnD,IAAI,CAAC,QAAQ,CAAC;gBACZ,OAAO;aACR,CAAC,CAAC;QACL,CAAC,CAAC;QAEF;;WAEG;QACK,yBAAoB,GAAG,CAAC,WAAmB,EAAQ,EAAE;YAC3D,IAAI,CAAC,QAAQ,CAAC;gBACZ,WAAW;aACZ,CAAC,CAAC;QACL,CAAC,CAAC;QAEF;;;;WAIG;QACK,aAAQ,GAAG,CAAC,KAAU,EAAQ,EAAE;YACtC,KAAK,CAAC,eAAe,EAAE,CAAC;QAC1B,CAAC,CAAC;QAEF;;;;WAIG;QACK,aAAQ,GAAG,CAAC,KAAU,EAAQ,EAAE;YACtC,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;YACrB,IAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC,CAAC;QAsDF;;;;WAIG;QACK,cAAS,GAAG,KAAK,IAAmB,EAAE;YAC5C,IAAI,CAAC,QAAQ,CAAC;gBACZ,QAAQ,EAAE,IAAI;aACf,CAAC,CAAC;YAEH,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,OAAO,EAAE;gBACjC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;aAC7C;iBAAM;gBACL,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;aAC9C;YACD,IAAI,CAAC,MAAM,EAAE,CAAC;YACd,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;QACvB,CAAC,CAAC;QAhMA,IAAI,CAAC,KAAK,GAAG;YACX,OAAO,EAAE,EAAE;YACX,WAAW,EAAE,EAAE;YACf,QAAQ,EAAE,KAAK;SAChB,CAAC;IACJ,CAAC;IAED;;;;OAIG;IACH,MAAM;QACJ,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACzD,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,QAAQ,CAAC;QAChD,OAAO,CACL,oBAAC,MAAM,IACL,OAAO,EAAE;gBACP,KAAK,EAAE,sBAAsB;aAC9B,EACD,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EACrB,OAAO,EAAE,IAAI,CAAC,QAAQ,EACtB,OAAO,EAAE,IAAI,CAAC,QAAQ;YAEtB,6BAAK,SAAS,EAAE,iBAAiB;gBAC/B,2BAAG,SAAS,EAAE,UAAU,IACrB,QAAQ;oBACP,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC;oBACvC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,eAAe,CAAC,CACtC;gBACJ,gCAAQ,SAAS,EAAE,gBAAgB;oBACjC,oBAAC,SAAS,IACR,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,mBAAmB,CAAC,EACrD,QAAQ,EAAC,OAAO,EAChB,OAAO,EAAE,IAAI,CAAC,QAAQ,GACtB,CACK,CACL;YACN,6BAAK,SAAS,EAAE,mBAAmB;gBACjC,+BACG,QAAQ;oBACP,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CACjB,8FAA8F,CAC/F;oBACH,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CACjB,8EAA8E,EAC9E,WAAW,CACZ,CACH;gBACH,QAAQ,IAAI,CACX,6BAAK,SAAS,EAAE,eAAe;oBAC7B,oBAAC,aAAa,IACZ,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,EACvB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAC3B,kBAAkB,EAAE,IAAI,CAAC,eAAe,EAAE,EAC1C,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,EACnC,sBAAsB,EAAE,IAAI,CAAC,mBAAmB,EAAE,EAClD,UAAU,EAAE,IAAI,CAAC,gBAAgB,EACjC,cAAc,EAAE,IAAI,CAAC,oBAAoB,GACzC,CACE,CACP,CACG;YACN,oBAAC,aAAa,IAAC,SAAS,EAAE,mBAAmB;gBAC3C,+BACE,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAC7B,SAAS,EAAE,OAAO,CAAC,WAAW,EAAE,iBAAiB,CAAC,EAClD,IAAI,EAAC,QAAQ,EACb,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,EAC5C,KAAK,EAAC,QAAQ,EACd,OAAO,EAAE,IAAI,CAAC,QAAQ,GACtB;gBACF,+BACE,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAC7B,SAAS,EAAE,OAAO,CAAC,WAAW,EAAE,iBAAiB,CAAC,EAClD,IAAI,EAAC,QAAQ,EACb,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,EAC5C,KAAK,EAAC,QAAQ,EACd,OAAO,EAAE,IAAI,CAAC,SAAS,GACvB,CACY,CACT,CACV,CAAC;IACJ,CAAC;IAwCD;;;;OAIG;IACK,KAAK,CAAC,YAAY,CAAC,IAAY;QACrC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;YACpB,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,qBAAqB,CAAC;SACpD,CAAC,CAAC;QACH,IAAI;YACF,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YAC3C,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,OAAO;gBACpB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,iCAAiC,CAAC;aAChE,CAAC,CAAC;SACJ;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,KAAK;gBAClB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,4BAA4B,CAAC;gBAC1D,KAAK,EAAE,IAAI,KAAK,CACd,mCAAmC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,EAAE,CAChE;aACF,CAAC,CAAC;SACJ;IACH,CAAC;IAED;;;;OAIG;IACK,KAAK,CAAC,aAAa,CAAC,IAAY;QACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;YACpB,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,oBAAoB,CAAC;SACnD,CAAC,CAAC;QACH,IAAI;YACF,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,IAAI,CAAC,CAAC;YACjE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,OAAO;gBACpB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,gCAAgC,CAAC;aAC/D,CAAC,CAAC;SACJ;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,KAAK;gBAClB,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,2BAA2B,CAAC;gBACzD,KAAK,EAAE,IAAI,KAAK,CAAC,oBAAoB,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,EAAE,CAAC;aACnE,CAAC,CAAC;SACJ;IACH,CAAC;IAqBD;;;;OAIG;IACK,eAAe;QACrB,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5D,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC;IAED;;;;OAIG;IACK,mBAAmB;QACzB,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CACxB,wBAAwB,EACxB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CACzB,CAAC;IACJ,CAAC;IAED;;;;OAIG;IACK,cAAc;QACpB,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;QAC7D,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,IAAI,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAClE,OAAO,OAAO,GAAG,MAAM,GAAG,IAAI,GAAG,IAAI,CAAC;IACxC,CAAC;IAED;;OAEG;IACK,MAAM;QACZ,IAAI,CAAC,QAAQ,CAAC;YACZ,OAAO,EAAE,EAAE;YACX,WAAW,EAAE,EAAE;YACf,QAAQ,EAAE,KAAK;SAChB,CAAC,CAAC;IACL,CAAC;CACF","sourcesContent":["import { TranslationBundle } from '@jupyterlab/translation';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport * as React from 'react';\nimport { classes } from 'typestyle';\nimport { Logger } from '../logger';\nimport {\n  actionsWrapperClass,\n  buttonClass,\n  cancelButtonClass,\n  closeButtonClass,\n  commitFormClass,\n  contentWrapperClass,\n  resetRevertDialogClass,\n  submitButtonClass,\n  titleClass,\n  titleWrapperClass\n} from '../style/ResetRevertDialog';\nimport { Git, IGitExtension, Level } from '../tokens';\nimport { CommitMessage } from './CommitMessage';\n\n/**\n * Interface describing component properties.\n */\nexport interface IResetRevertDialogProps {\n  /**\n   * Type of action to perform.\n   */\n  action: 'reset' | 'revert';\n\n  /**\n   * Commit data for a single commit.\n   */\n  commit: Git.ISingleCommitInfo;\n\n  /**\n   * Extension data model.\n   */\n  model: IGitExtension;\n\n  /**\n   * Extension logger\n   */\n  logger: Logger;\n\n  /**\n   * Boolean indicating whether to show the dialog.\n   */\n  open: boolean;\n\n  /**\n   * Callback invoked upon closing the dialog.\n   */\n  onClose: () => void;\n\n  /**\n   * The application language translator.\n   */\n  trans: TranslationBundle;\n}\n\n/**\n * Interface describing component state.\n */\nexport interface IResetRevertDialogState {\n  /**\n   * Commit message summary.\n   */\n  summary: string;\n\n  /**\n   * Commit message description.\n   */\n  description: string;\n\n  /**\n   * Boolean indicating whether component buttons should be disabled.\n   */\n  disabled: boolean;\n}\n\n/**\n * React component for rendering a dialog for resetting or reverting a single commit.\n */\nexport class ResetRevertDialog extends React.Component<\n  IResetRevertDialogProps,\n  IResetRevertDialogState\n> {\n  /**\n   * Returns a React component for resetting or reverting a single commit.\n   *\n   * @param props - component properties\n   * @returns React component\n   */\n  constructor(props: IResetRevertDialogProps) {\n    super(props);\n    this.state = {\n      summary: '',\n      description: '',\n      disabled: false\n    };\n  }\n\n  /**\n   * Renders a dialog.\n   *\n   * @returns React element\n   */\n  render(): React.ReactElement {\n    const shortCommit = this.props.commit.commit.slice(0, 7);\n    const isRevert = this.props.action === 'revert';\n    return (\n      <Dialog\n        classes={{\n          paper: resetRevertDialogClass\n        }}\n        open={this.props.open}\n        onClick={this._onClick}\n        onClose={this._onClose}\n      >\n        <div className={titleWrapperClass}>\n          <p className={titleClass}>\n            {isRevert\n              ? this.props.trans.__('Revert Changes')\n              : this.props.trans.__('Reset Changes')}\n          </p>\n          <button className={closeButtonClass}>\n            <ClearIcon\n              titleAccess={this.props.trans.__('Close this dialog')}\n              fontSize=\"small\"\n              onClick={this._onClose}\n            />\n          </button>\n        </div>\n        <div className={contentWrapperClass}>\n          <p>\n            {isRevert\n              ? this.props.trans.__(\n                  \"These changes will be reverted. Only commit if you're sure you're okay losing these changes.\"\n                )\n              : this.props.trans.__(\n                  'All changes after commit %1 will be gone forever (hard reset). Are you sure?',\n                  shortCommit\n                )}\n          </p>\n          {isRevert && (\n            <div className={commitFormClass}>\n              <CommitMessage\n                trans={this.props.trans}\n                summary={this.state.summary}\n                summaryPlaceholder={this._defaultSummary()}\n                description={this.state.description}\n                descriptionPlaceholder={this._defaultDescription()}\n                setSummary={this._onSummaryChange}\n                setDescription={this._onDescriptionChange}\n              />\n            </div>\n          )}\n        </div>\n        <DialogActions className={actionsWrapperClass}>\n          <input\n            disabled={this.state.disabled}\n            className={classes(buttonClass, cancelButtonClass)}\n            type=\"button\"\n            title={this.props.trans.__('Cancel changes')}\n            value=\"Cancel\"\n            onClick={this._onClose}\n          />\n          <input\n            disabled={this.state.disabled}\n            className={classes(buttonClass, submitButtonClass)}\n            type=\"button\"\n            title={this.props.trans.__('Submit changes')}\n            value=\"Submit\"\n            onClick={this._onSubmit}\n          />\n        </DialogActions>\n      </Dialog>\n    );\n  }\n\n  /**\n   * Callback invoked upon updating a commit message summary.\n   */\n  private _onSummaryChange = (summary: string): void => {\n    this.setState({\n      summary\n    });\n  };\n\n  /**\n   * Callback invoked upon updating a commit message description.\n   */\n  private _onDescriptionChange = (description: string): void => {\n    this.setState({\n      description\n    });\n  };\n\n  /**\n   * Callback invoked upon clicking on a dialog.\n   *\n   * @param event - event object\n   */\n  private _onClick = (event: any): void => {\n    event.stopPropagation();\n  };\n\n  /**\n   * Callback invoked upon closing the dialog.\n   *\n   * @param event - event object\n   */\n  private _onClose = (event: any): void => {\n    event.stopPropagation();\n    this.props.onClose();\n    this._reset();\n  };\n\n  /**\n   * Reset the current branch on the provided commit\n   *\n   * @param hash Git commit hash\n   */\n  private async _resetCommit(hash: string): Promise<void> {\n    this.props.logger.log({\n      level: Level.RUNNING,\n      message: this.props.trans.__('Discarding changes…')\n    });\n    try {\n      await this.props.model.resetToCommit(hash);\n      this.props.logger.log({\n        level: Level.SUCCESS,\n        message: this.props.trans.__('Successfully discarded changes.')\n      });\n    } catch (error) {\n      this.props.logger.log({\n        level: Level.ERROR,\n        message: this.props.trans.__('Failed to discard changes.'),\n        error: new Error(\n          `Failed to discard changes after ${hash.slice(0, 7)}: ${error}`\n        )\n      });\n    }\n  }\n\n  /**\n   * Revert the provided commit.\n   *\n   * @param hash Git commit hash\n   */\n  private async _revertCommit(hash: string): Promise<void> {\n    this.props.logger.log({\n      level: Level.RUNNING,\n      message: this.props.trans.__('Reverting changes…')\n    });\n    try {\n      await this.props.model.revertCommit(this._commitMessage(), hash);\n      this.props.logger.log({\n        level: Level.SUCCESS,\n        message: this.props.trans.__('Successfully reverted changes.')\n      });\n    } catch (error) {\n      this.props.logger.log({\n        level: Level.ERROR,\n        message: this.props.trans.__('Failed to revert changes.'),\n        error: new Error(`Failed to revert ${hash.slice(0, 7)}: ${error}`)\n      });\n    }\n  }\n\n  /**\n   * Callback invoked upon clicking a button to reset or revert a commit.\n   *\n   * @param event - event object\n   */\n  private _onSubmit = async (): Promise<void> => {\n    this.setState({\n      disabled: true\n    });\n\n    if (this.props.action === 'reset') {\n      this._resetCommit(this.props.commit.commit);\n    } else {\n      this._revertCommit(this.props.commit.commit);\n    }\n    this._reset();\n    this.props.onClose();\n  };\n\n  /**\n   * Returns a default commit summary for reverting a commit.\n   *\n   * @returns default commit summary\n   */\n  private _defaultSummary(): string {\n    const summary = this.props.commit.commit_msg.split('\\n')[0];\n    return this.props.trans.__(\"Revert '%1'\", summary);\n  }\n\n  /**\n   * Returns a default commit description for reverting a commit.\n   *\n   * @returns default commit description\n   */\n  private _defaultDescription(): string {\n    return this.props.trans.__(\n      'This reverts commit %1',\n      this.props.commit.commit\n    );\n  }\n\n  /**\n   * Returns a commit message for reverting a commit.\n   *\n   * @returns commit message\n   */\n  private _commitMessage(): string {\n    const summary = this.state.summary || this._defaultSummary();\n    const desc = this.state.description || this._defaultDescription();\n    return summary + '\\n\\n' + desc + '\\n';\n  }\n\n  /**\n   * Resets component state.\n   */\n  private _reset(): void {\n    this.setState({\n      summary: '',\n      description: '',\n      disabled: false\n    });\n  }\n}\n"]}